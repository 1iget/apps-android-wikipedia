// see also http://stackoverflow.com/questions/17050654/get-android-gradle-plugin-checkstyle-working-together-command-line-usage

apply plugin: 'checkstyle'

check.dependsOn 'checkstyle'

task checkstyle(type: Checkstyle) {
    configFile file("${project.rootDir}/config/checkstyle.xml")
    source 'src/main/java'
    source 'src/androidTest/java'
    include '**/*.java'
    exclude '**/gen/**'

    classpath = configurations.compile
}

// --- testAll tasks ---
// These tasks execute both JVM JUnit and Android instrumentation tests (per variant).

def addTestAllTask = { testAllName, jvmJUnitName, androidInstrumentationName ->
    def testAllTask = task (testAllName) {
        // Run JVM JUnit tests and Android instrumentation tests.
        dependsOn ([jvmJUnitName, androidInstrumentationName])
    }

    // JVM JUnit tests execute quickest and should be attempted prior to Android instrumentation tests.
    testAllTask.shouldRunAfter jvmJUnitName
}

// Add testAll tasks for each build variant.
android.applicationVariants.all { variant ->
    def variantName = variant.name.capitalize()
    def testAllName = "testAll${variantName}"
    def jvmJUnitName = "test${variantName}"
    def androidInstrumentationName = "connectedAndroidTest${variantName}"

    addTestAllTask(testAllName, jvmJUnitName, androidInstrumentationName)
}

// Add testAll task for all configurations.
addTestAllTask('testAll', 'test', 'connectedAndroidTest')
// --- /testAll ---